<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>StockSentiments by Alexander Lin, Angela Jiang, and Jason Shen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript" src="js/nav.js"></script>
    <script>
    $(document).ready(function(){
      // Add smooth scrolling to all links
      $("a").on('click', function(event) {

        // Make sure this.hash has a value before overriding default behavior
        if (this.hash !== "") {
          // Prevent default anchor click behavior
          event.preventDefault();

          // Store hash
          var hash = this.hash;

          // Using jQuery's animate() method to add smooth page scroll
          // The optional number (800) specifies the number of milliseconds it takes to scroll to the specified area
          $('html, body').animate({
            scrollTop: $(hash).offset().top
          }, 800, function(){
       
            // Add hash (#) to URL when done scrolling (default click behavior)
            window.location.hash = hash;
          });
        } // End if
      });
    });
    </script>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">StockSentiments</h1>
      <h2 class="project-tagline">Predicting Stock Prices Using Sentiment Analysis</h2>
      <!--<a href="https://github.com/cwjshen/StockSentiments" class="btn">View on GitHub</a>
      <a href="https://github.com/cwjshen/StockSentiments/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/cwjshen/StockSentiments/tarball/master" class="btn">Download .tar.gz</a>-->
      <a href="https://cwjshen.github.io/StockSentiments/#overview" class="btn">Overview</a>
      <a href="https://cwjshen.github.io/StockSentiments/#objectives" class="btn">Objectives</a>
      <a href="https://cwjshen.github.io/StockSentiments/#methods" class="btn">Methods</a>
      <a href="https://cwjshen.github.io/StockSentiments/#analysis" class="btn">Analysis & Modeling</a>
      <a href="https://cwjshen.github.io/StockSentiments/#challenges" class="btn">Challenges</a>
      <a href="https://cwjshen.github.io/StockSentiments/#future" class="btn">Conclusion and Future Work</a>

    </section>

    <section id="main" class="main-content">
      <h3>
<a id="overview" class="anchor" href="#Project Overview" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Project Overview</h3>

<p>The purpose of this project is to explore how a published article about a particular company can affect that company's stocks. For this project specifically, we explore how the release of a New York Times article
impacts, if at all, Apple stock prices.</p>



<center> <img src="img/nyt.gif" alt="The New York Times" style="width:128px;height:128px;" align="middle"> 
<img src="img/appl.png" alt="Apple" style="width:128px;height:128px;" align="middle"> </center>

<h3>
<a id="objectives" class="anchor" href="objectives" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Objectives</h3>

<p>In particular we wanted to explore the potential answers to some of these questions:</p>

<ul>
  <li>Using past data, given the release of an article, are we able to witness a noticeable change in a company's stock prices</li>
  <li>What should this change take look like?
      <ul>
          <li>How much of a change should we consider to be significant?</li>
          <li>What sort of time frame between article release and price change should we look at? Changes within an hour? A day? A week?</li>
          <li>How do these changes look over the course of a long period of time, going back several years?</li>
      </ul>
  </li>
  <li>Can we use this data to build a model that will predict how the release of a future article will affect future stock prices?</li>

</ul>


<h3>
<a id="methods" class="anchor" href="methods" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Methods</h3>

<p><b>Data Collection</b></p>
<p>We pulled our news articles from the <a href="https://developer.nytimes.com/">New York Times API</a>. We took all news articles over the past 10 years dating from December 2006 to December 2016 and ended up with over 650,000 articles. We chose the New York Times API specifically because it was relatively easy to use and provided all the relevant information for the scope of our project including date of release, headline, and abstract. Our project focused on using the headlines as predictors.</p>

<p><b>Data Cleaning</b></p>

<p>Since we wanted to focus on Apple stocks, we first filtered our data by key words related to Apple or Apple products, such as "Apple", "Mac", and "iPhone", in the headlines. We then removed all punctuation and capitalization. We experimented with using [Alex fill this part in POS] and word stemming on the filtered headlines.</p>

Filtered (no POS, no stemming)
<img src="img/filtered_df.png">
Filtered (yes POS, no stemming)
<img src="img/filtered_pos_df.png">
Filtered (no POS, yes stemming)
<img src="img/filtered_stem_df.png">
Filtered (yes POS, yes stemming)
<img src="img/filtered_pos_stem_df.png">

<p>We tokenized the headlines into single words. </p>

<p>For stock prices NASDAQ had a built-in feature on their website where we could specify a time range and download the stock price data of a company for that time period conveniently as a CSV file. The stock data contained information about:</p>

<ul>
  <li> The opening and closing prices of the stock for that business day </li>
  <li> The max and min prices of the stock for that business day </li>
  <li> The number of shares that were traded for the day </li>
</ul>

<p>However, for our purposes, we only used the closing prices of each day to determine whether or not a stock had gone up or down following the release of an article.</p>

<h3>
  <a id="analysis" class="anchor" href="analysis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Analysis and Modeling
</h3>

<p><b>Adaboosting</b></p>
<p>We attempted AdaBoosting with Decision Stumps as our weak classifiers for the simple reason that subsequent weak learners can be weighed as a result of misclassification of a previous classifier thus potentially leading to a strong classifier. We rationalized its usage based on it's resistance against overfitting which can easily happen as our original dataset consist Although AdaBoosting can be sensitive to overfitting, we imagined by filtering article headlines down to only their nouns and their adjectives we would be able to reduce the noise in our data.</p>

<p>After parameterizing the number of estimators for our AdaBoost classifier that yielded us the highest accuracy score, we created another AdaBoost Classifier with the same parameters and created random training/testing sets to observe the distributions of True Positive and True Negative Scores to see if there was some sort of consistency in our scores.</p>

<center> <img src="img/AdaBoost_cv.png" align="middle" style="width:500px"> </center>
<br>
<center> <img src="img/adaboost_score_histogram.png" align="middle"> </center>

<p>Looking at the distribution of scores makes it apparent that the AdaBoost doesn't seem to be reliable because it fails to be consistent with its scores. This is probably due to the fact that our dataset isn't large enough or precise enough to capture any sort of pattern relating words to stock price changes. There is too much variability in what the True Positive and True Negative scores are for our AdaBoost Classifier to have any sort of significant predictive power.</p>

<p><b>Random Forest</b></p>
<p>[TODO (Angela): write about why we chose random forest]<p>
<p>Hypertuned: Removal of all words except nouns and adjectives <b>(POS)</b>, removal of stem words <b>(Stem)</b>, the number of occurrences a word has to have before being put into our bag of words <b>(occurrence threshold)</b>, whether no PCA dimensionality reduction is performed or with dimensionality = 2 <b>(No PCA/PCA(2)
)</b>, along with tree number of leaves, number of trees, and depth of the trees. Overall the time complexity of hypertuning along with cross validation of our selected parameters required a substantial amount of time even with multiprocessing capabilities. Our scoring function specified that both the True Positive rate and the True Negative rate both had to be above 0.5 or else the model's score would be 0, thus yielding Random Forest Classifiers with potentially some predictive power.</p>
<br>
<figure>
  <figcaption><center>Threshold for classification 1: > 0.5% increase</center></figcaption>
  <center> <img src="img/hypertuning_threshold_gt_005.png" align="middle"> </center>
</figure>
<br>
<figure>
  <figcaption><center>Threshold for classification 0: < 0.5% decrease</center></figcaption>
  <center> <img src="img/hypertuning_threshold_lt_005.png" align="middle"> </center>
</figure>
<br>
<p>Because we set a threshold for a news article to be classified to be a <b>1</b>, this caused an imbalance in our dataset since intuitively setting a high threshold would mean less observations that will be classified as <i>positive</i>. Thus we also set the threshold in the opposite direction where an observation would be classified as <i>negative</i> only if the observation associated stock price has a price difference from the previous day of 0.5%</p>

<p>In order to test which model would do the best we simulated (50 times per model) how our model would do against several baseline models: always sell, always buy, 50/50, and a fortune teller. [TODO (Angela): Write more if u want to here]. Each model has an "average profit" which denotes the amount of money you would make each day if you followed the model with 1 stock for 10 years.</p>

<figure>
  <center><img src="img/gt_scores.png" align="middle"><img src="img/lt_scores.png" align="middle"></center>
</figure>

<p>We can see from the scores that models 19 and 30 did the best. However we can see that Model 30 does, on average, better than Model 19. Below we compare and show the relative performance of the baseline models where the blue line is the model average profit, red is the always buy baseline model average profit, and black is the 50/50 random baseline model. </p>

<figure>
  <center> <img src="img/model_19_hist.png" align="middle" style="width:375px" ><img src="img/model_30_hist.png" align="middle" style="width:375px"></center>
</figure>
<br>

<p>Both models do well in terms of the baseline models on average, thus we can say with some confidence that our models do better than baseline models, however it seems like Model 30 does slightly better than Model 19 in terms of how often it does better than the baseline model and by how much.</p>


<p><b>Application - Stock Trading</b></p>

<p><b>[TODO: There's some overlap between what's written here and what's written in the analysis. Reconcile?]</b></p>
<p>We can interpret our model as a decision maker for buying and selling stocks. In the end, we should ideally expect that these series of decisions will net us some profit greater than some naive method like flipping a coin.</p>

<p>We created a function that would simulate our decisions to buy and sell stocks based on the predictions of our trained model. We outline the function as the following: </p> 

<ul>
  <li> We assume to start that we start off with some existing shares of the stock so that we are able to sell without buying additional shares </li>
  <li> If the model predicts an increase in stock price, we will preemptively purchase some number of shares of the stock. </li>
  <li> If the model predicts a decrease in stock price, we will preemptively sell the same number of shares of this stock. </li>
  <li> At the end of each day, we see how much profit or loss occurred as a result of our decision</li>
  <li> We average these profits/losses per day across all ten years to get the average profit/loss that our model will produce per decision </li>
    <ul>
      <li> We decided to do this on a day-by-day basis rather then just taking the cumulative profits across all ten years to avoid the effects of inflation. </li>
    </ul>
</ul>

<p> We then compare the results of our model to the results of the following baseline decision makers:</p>
<ul>
  <li> A random coinflip - i.e. You flip a coin, if heads you buy, if tails you sell for that day.</li>
  <li> Positive baseline - i.e. If an article is released, you always buy</li>
  <li> Negative baseline - i.e. If an article is released, you always sell</li>
  <li> A fortune teller - i.e. We know exactly how the stock will behave as a result of the article and we buy/sell perfectly.   </li>
</ul>

<h3>
  <a id="challenges" class="anchor" href="challenges" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Challenges
</h3>

<p>We ran into some issues with our initial data collection when we realized we were missing a lot of data when we used the <a href="https://developer.nytimes.com/timeswire_v3.json">Times Newswire </a> part of NYT's API. We wanted to use this API because it conveniently provided a lot of useful metadata such as abstract and title. But there seemed to be many articles missing when we tried pulling from the past decade. Times Newswire seemed to only provide all the articles from the most recent year and only a select few from the past years. We instead had to use the <a href="https://developer.nytimes.com/archive_api.json"> Archive API</a>, which gave us all the articles, but we had to do a little extra gruntwork to get the metadata.</p>

<p><b>[TODO: ADD CHALLENGES REGARDING MODELING]</p>

<h3>
  <a id="future" class="anchor" href="future" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Conclusion and Future Work
</h3>
      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/cwjshen/StockSentiments">Stocksentiments</a> is maintained by <a href="https://github.com/cwjshen">cwjshen</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
